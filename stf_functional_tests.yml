---
- name: "Check that collectd is running and generating any metrics"
  hosts: overcloud_nodes
  ignore_errors: true
  become: true
  tasks:
    - import_role: name="{{ playbook_dir }}"

    - name: "Update container_bin var"
      block:
        - stat:
            path: "/usr/bin/podman"
          register: st_pod
        - set_fact:
            container_bin: docker
          when: not st_pod.stat.exists

    - name: "Run collectd tests"
      import_tasks: tasks/test_collectd.yml
      tags:
        - collectd-write-qdr-edge-only
        - collectd-write-qdr-mesh
        - enable-stf

    - name: "Run metrics_qdr tests"
      import_tasks: tasks/test_qdr.yml
      tags:
        - collectd-write-qdr-edge-only
        - collectd-write-qdr-mesh
        - ceilometer-write-qdr-edge-only
        - ceilometer-write-qdr-mesh
        - enable-stf
